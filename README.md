# Ad Alchemy

По ссылке на группу ВКонтакте бот анализирует группу и последние 50 постов, считает engagement, прогоняет данные через цепочку промптов (анализ → объявления → промпт для картинки) и отдаёт в Telegram: анализ, варианты объявлений и промпты для генерации изображений.

## Цепочка промптов

1. **Анализ ВК** — на основе названия, описания, участников и топ-постов по engagement: темы, аудитория, форматы, рекламные углы, сегменты, ключевые слова. Ответ в JSON.
2. **Генерация объявлений** — по результатам анализа: 2–4 варианта с заголовком, текстом, CTA, визуальной концепцией и коротким описанием для картинки. Ответ в JSON.
3. **Промпт для картинки** — для каждого варианта: детальный фотореалистичный промпт под баннер ВК (без текста на изображении). Только текст.
4. **Генерация изображения** — пока не реализована; в Telegram отправляются данные для объявления и готовый промпт для визуальной нейросети.

## Установка

```bash
python -m venv .venv
.venv\Scripts\activate   # Windows
pip install -r requirements.txt
```

## Настройка

1. Скопируйте `.env.example` в `.env`.
2. **Telegram:** создайте бота через [@BotFather](https://t.me/BotFather), укажите `TELEGRAM_BOT_TOKEN`.
3. **VK:** access token с правами `groups` → `VK_ACCESS_TOKEN`.
4. **LLM:** любой OpenAI-совместимый API (OpenAI, DeepSeek, Qwen). Укажите `LLM_API_KEY`, при необходимости `LLM_BASE_URL` и `LLM_MODEL`.

## Запуск

```bash
python main.py
```

Отправьте боту ссылку на группу ВК. Бот ответит «Ваше объявление создаётся», затем пришлёт: краткий анализ, ключевые слова и по каждому варианту объявления — заголовок, текст, CTA, визуальную концепцию и **промпт для генерации изображения**.

## Структура

- `src/vk_client.py` — данные группы и стены, engagement по формуле `(likes + comments*2 + reposts*3) / views`.
- `src/prompts.py` — системные и пользовательские промпты для шагов 1–3.
- `src/llm_client.py` — вызов OpenAI-совместимого chat completion (JSON и текст).
- `src/campaign_generator.py` — асинхронный пайплайн: анализ → объявления → промпты для картинок.
- `src/bot.py` — Telegram-бот, асинхронная отправка результата.

## Публикация в ВК

Рядом с каждым вариантом объявления в боте показывается кнопка **«Опубликовать в ВК»**. По нажатию открывается страница на вашем сервере, где пользователь входит через VK OAuth, после чего в его рекламном кабинете ВКонтакте создаётся одна кампания с одним объявлением (целевая аудитория, бюджет и текст берутся из выбранного варианта).

**Настройка бота:** в `.env` задайте `PUBLISH_BASE_URL` (например `https://feedcraft.ru`) и `PUBLISH_JWT_SECRET` — общий секрет для подписи ссылок.

**Размещение PHP:** положите `vk-publish.php` на сайт по адресу `{PUBLISH_BASE_URL}/vk-publish.php`. В окружении сервера (или в конфиге веб-сервера) задайте:

- `VK_APP_ID`, `VK_APP_SECRET` — ID и секрет приложения ВКонтакте (тип « standalone »).
- `PUBLISH_JWT_SECRET` — тот же секрет, что и в боте.
- `PUBLISH_BASE_URL` — базовый URL сайта (для redirect_uri).

В настройках приложения ВК укажите Redirect URI: `https://feedcraft.ru/vk-publish.php` (или ваш домен) и включите доступ к рекламе (права `ads`).
